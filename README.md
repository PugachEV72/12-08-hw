# Домашнее задание к занятию 12.08 «Резервное копирование баз данных» - Пугач Евгений


---

## `Задание 1. Резервное копирование`

### Ответ:

```
1.1 Так как в кейсе указано, что это именно финансовая компания, предположим,    
что работает она круглосуточно. Чтобы восстанавливать данные в полном объёме за предыдущий день,
следует выполнять полное резервное копирование со снапшота в то время, когда наблюдается
наименьшая нагрузка на сервис, соответственно высвобождаются ресурсы для проведения бэкапа,
предположим после 01.00 следующих суток.
```
```
1.2 Для того, чтобы восстанавливать данные за час до предполагаемой поломки, следует настроить
дифференциальное копирование на отдельном сервере каждые 20 - 30 минут, таким образом мы получим
возможность откатить базу на состояние "за час до инцидента", при этом использовать полный бэкап
за предыдущие сутки.
```
```
1.3 Кейс, когда при поломке базы происходит моментальное переключение на работающую базу данных
возможен, но это уже не резервное копирование, а реплицирование, пригоден он для случаев,
когда возникают проблемы, например, с доступностью сервера (выход из строя железа, сети и т.д.).
Структура может выглядеть следующим образом: master-сервер и несколько slave-серверов.
```

---

## `Задание 2. PostgreSQL`

### Ответ:

```
2.1 Для создания дампа потребуется ввести команду
pg_dump (параметры)(имя базы) > (файл для сохранения копии).

Можно сделать полную копию так:
pg_dumpall > (файл для сохранения копии).

Для восстановления потребуется ввести
pg_restore (параметры)(имя базы) (файл копии ), также можно использовать
psql (параметры)(имя базы) < (файл копии).
```
```
2.2 Автоматизировать этот процесс возможно. Самый простой вариант - bash-скрипт, с настройкой
регулярного выполнения в планировщике crontab (например, ночью, когда база не нагружена).
```

---

## `Задание 3. MySQL`

```
3.1 Вполне возможно создать инкрементный бэкап используя Mysqlbackup с параметром  –incremental
или --incremental-base=history:last_backup backup-to-image

При создании резервной копии можно указать mysqlbackup момент времени предыдущей полной или
добавочной резервной копии, используя опцию --incremental-base автоматического получения
необходимого порядкового номера журнала (LSN) из метаданных, хранящихся в предыдущем каталоге
резервных копий или на сервере.

Ну и восстановление, соответственно:
mysqlbackup с параметром --incremental copy-back-and-apply-log,
 
пример:
mysqlbackup --defaults-file=<my.cnf> -uroot --backup-image=<inc_image_name> \
  --backup-dir=<incBackupTmpDir> --datadir=<restoreDir> --incremental \
  copy-back-and-apply-log
```
```
3.1 Использование реплики будет давать преимущество в случае отказа основного сервера - можно
моментально переключиться на запасной.
```

---
